# 数域筛法 (Number Field Sieve)

## 前置知识

### 算术基本定理

对于任何一个大于$1$的数$n$，有且仅有一种方法，将其写成有限个素数幂的乘积。

### 因子基

> 由算术基本定理，对于任何一个数$n$，我们可以找到有限个素数，将$n$写为这些素数幂的乘积；这些素数构成的集合$P$，称为$n$的因子基。

### 光滑数

能被一系列较小的素数分解的数，称为光滑数。光滑的概念通常伴随一个确定的因子基出现，因此常说：

> “对于一个确定的因子基$P$，若某个合数$t$能被$P$分解，则称$t$是$P$上的光滑数。”

在理论应用中，通常设置一个上界$B$，使$P$包含所有不大于$B$的素数；此时能被这样的$P$分解的数称为$B-$光滑数。

### 素多项式

> 指不能被分解为两个多项式乘积的多项式^[2]^。

## 有理筛法

同此前的二次筛法，这一方法的核心思想仍然是通过构造平方数关于$n$的同余关系式
$$
x^2 \equiv y^2\pmod{n}
$$
利用式子
$$
n = \gcd(x + y, n) \cdot \gcd(x - y, n)
$$
完成对$n$的质数分解^[1]^。

- 步骤1：对于需要分解的一个合数$n$，取一个合理的初始上界$B$，从而得到一个对应的因子基$P$；

- 步骤2：若$P$中的一个或几个元素可以整除$n$，则可以退化到一个更小数的有理筛分解问题；若不能，则继续步骤3；

- 步骤3：我们可以寻找正整数$z$，使得$ z$ 与$z+n$都是$B-$光滑数，且显然有
  $$
  z \equiv z+n \pmod{n}
  $$
  
- 步骤4：从小到大寻找满足条件的$z$；一般情况下，当寻找数量与因子基$P$的规模相当时，可以从对应的多个同余方程式中，选取一个或几个相乘，得到的新同余式即为，或可化简为两个完全平方数$x^2$与$y^2$的同余式。

- 步骤5：根据得到的$x^2$与$y^2$，利用上述完全平方同余式完成对$n$的质数分解。

### 示例

分解合数$187$；

不妨取$B = 7$，得到对应的因子基$P = \{2, 3, 5, 7\}$；不难验证，$187$无法被$P$中任何一个元素整除。随后我们开始寻找正整数$z$，使得$ z $与$ z+n $都是$7-$光滑数。由于$|P|=4$，按顺序找到的前$4$个$z$分别为$2, 5, 9, 56$，可以得到$4$个同余关系式：

$$
\begin{align}
&2^1  3^0  5^0  7^0 = 2 \equiv 189 = 2^0  3^3  5^0  7^1 \pmod{187}\\
&2^0  3^0  5^1  7^0 = 5  \equiv 192 = 2^6  3^1  5^0  7^0 \pmod{187}\\
&2^0  3^2  5^0  7^0 = 9  \equiv 196 = 2^2  3^0  5^0  7^2 \pmod{187}\\
&2^3  3^0  5^0  7^1 = 56  \equiv 243 = 2^0  3^5  5^0  7^0 \pmod{187}\\
\end{align}
$$


可以发现，第三个式子直接满足了完全平方数的同余关系，可以直接得到 
$$
3^2 \equiv 14^2\pmod{187}
$$
则有
$$
n = \gcd(14 + 3, 187) \cdot \gcd(14 - 3, 187) = 11 \times  17
$$
也可以利用第一个和第四个式子相乘得到
$$
2^4 \times 7 \equiv 3^8 \times 7 \pmod{187}
$$
即 
$$
4^2 \equiv 81^2 \pmod{187}
$$
则
$$
n = \gcd(81 + 4, 187) \cdot \gcd(81 - 4, 187) = 11 \times  17
$$

### 有理筛法的局限性

若某个数本身就是某个素数的幂，则有理筛法无法对其进行分解，但在统计角度看来，这样的数很少，且容易验证为素数的幂，故不会对实际的应用造成太大影响。



## 狭义数域筛法 (Special Number Field Sieve)

在引言中，我们介绍了有理筛法，主要由两个步骤实现：

- 寻找关于因子基$P$光滑的$z$和$z+n$，且至少找到$|P|$个这样的$z$；

- 根据上述$z$与$z+n$得到同余关系式，并选取其中的某些相乘，得到完全平方数的同余式，即形如$x^2 \equiv y^2 \pmod n$的式子，最后利用式子
  $$
  n = \gcd(x + y, n) \cdot \gcd(x - y, n)
  $$
  完成对n的质数分解。

在要接下来即将介绍的狭义数域筛法中，仅有第一步操作与有理筛法不同。我们可以利用数域的特性，构建比有理筛法更高效的整数分解算法。

### 基本步骤

- 选取一个系数均为整数的素多项式$f$ , 以及一个整数 $m $使得 $f(m) \equiv 0 \pmod n$；选定后，令$\alpha$为$f$的根；由此可以产生一个环域$\Z[\alpha]$，且存在环同态函数$\varphi:\Z[\alpha]\rightarrow\Z/n\Z$，将$\alpha$映射至$m$. 为了讨论的简便，假设$\Z[\alpha]$是一个唯一分解环
- 在两个环域中，分别取两组因子基$P_1$与$P_2$，在$\Z[\alpha]$上的因子基$P_1$由$N_{max}$确定上界，在$\Z$上$P_2$则由$B$确定上界；同上述有理筛法，两组因子基均包含环域中不超过上界的所有质数；
- 开始寻找互质的数对$(a,b)$，使在两个环域中分别满足：$a+bm$是关于$P_2$的光滑数；$a+b\alpha$是关于$P_1$的光滑数；
- 当找到这样足够多的数对时，可以生成一个幂系数矩阵，使用线性代数中求解线性方程组的方法，可以解得形如$x^2 \equiv y^2 \pmod n$的完全平方同余式。

这种通过环域上的性质进行筛选得到完全平方同余式的过程，即为狭义数域筛法，简称**SNFS**.

### 局限性

若一个数可以写为$r^e \pm s$形式，且$r$和$s$都不太大时，或者更一般地写为$ar^e\pm bs^f$时，狭义数域筛法可以较为高效地对其进行分解；如若不能，则其效率受限；大致原因，对于一个广义多项式，若其系数较大，则其对应的范数也更大；由于**SNFS**在进行分解时，依赖于固定的素数集，范数过大时，不易进行分解，导致算法效率很低；更加细致的分析需要更多关于抽象代数和环论的知识，再此不做赘述。

### 时间复杂度

摘自维基百科^[3]^，对于$n$位整数，此算法的时间复杂度为：

$$
\exp \left(\left(1+o(1)\right)\left({\tfrac  {32}{9}}\log n\right)^{{1/3}}\left(\log \log n\right)^{{2/3}}\right)=L_{n}\left[1/3,(32/9)^{{1/3}}\right]
$$

## 广义数域筛法(General Number Field Sieve)

与狭义数域筛法思想相同，广义数域筛在有理筛法的基础上，也只对寻找同余关系式的方法进行改进，通过这些同余关系式获得完全平方同余式的方法是线性代数中主要研究的问题，在此略去。

广义数域筛法是狭义数域筛法的推广，通过使用两个素多项式，同时确定两个环域，来更高效地进行筛选。

### 具体步骤

选取两个多项式$f(x)$与$g(x)$，使它们满足：

- 系数均为整数
- 是有理数域上的素多项式
- 次数分别为确定的常数$d$和$e$，且都不太大
- $f(x)$与$g(x)$对$n$取模后，有共同的整数根$m$

对于上述$f(x)$与$g(x)$，可以分别求得根$r_1$与$r_2$。对于某个整数对$(a,b)$，$r = b^d f(\frac{a}{b}), s = b^e g(\frac{a}{b})$，不难验证，$r$与$s$均为整数；考虑数域环$\Z[r_1]$与$\Z[r_2]$，设在数域环$\Z[r_1]$与$\Z[r_2]$上所选因子基分别为$P_1$与$P_2$，该算法的目标是寻找恰当的整数对$(a,b)$，使$r$与$s$分别关于$P_1$和$P_2$光滑。

在找到足够多的整数对$(a,b)$后，使用高斯消元法，可以使$r$和$s$同时为平方数，从而得到所需的完全平方同余式。

### 时间复杂度

摘自维基百科^[4]^，对于$n$位整数，此算法的时间复杂度为：

$$
\exp \left(\left({\sqrt[{3}]{\frac {64}{9}}}+o(1)\right)(\ln n)^{\frac {1}{3}}(\ln \ln n)^{\frac {2}{3}}\right)=L_{n}\left[{\frac {1}{3}},{\sqrt[{3}]{\frac {64}{9}}}\right]
$$


## 参考文献

[1] Rational sieve-Wikipedia, the free encyclopedia[EB/OL]. 2019.https://en.wikipedia.org/wiki/Rational_sieve

[2] Irreducible polynomial-Wikipedia, the free encyclopedia[EB/OL]. 2019.https://en.wikipedia.org/wiki/Irreducible_polynomial

[3] Special number field sieve-Wikipedia, the free encyclopedia[EB/OL]. 2019.https://en.wikipedia.org/wiki/Special_number_field_sieve

[4] General number field sieve-Wikipedia, the free encyclopedia[EB/OL]. 2019.https://en.wikipedia.org/wiki/General_number_field_sieve