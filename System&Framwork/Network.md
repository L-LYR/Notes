# 计算机网络笔记

# 计算机网络和因特网

## 因特网基本描述

### 基本构成描述

主机（host）端系统（end system）：计算机网络（Computer Network）中的设备

通信链路（communication link）分组交换机（packet switch）：连接端系统

传输速率（transmission rate）（bit/s bps）：链路传输速率

路由器（router）链路层交换机（link-layer switch）：交换机的两种主要类型，转发分组（数据块）

服务提供商（ISP Internet Service Provider）：连接端系统到因特网

因特网工程任务组（IETF Internet Engineering Task Force）：研发因特网标准（Internet Standard），其标准文档为请求评论（RFC Request For Comments）

### 服务描述

向应用程序提供服务的基础设施和编程接口。

套接字接口（socket interface）：规定了运行在一个端系统上的程序请求因特网基础设施向运行在另一个端系统上的特定目的地程序交付数据的方式。

### 协议

协议（protocol）：定义了在两个或多个通信实体之间交换的报文的格式和顺序，以及报文发送和/或接收一条报文或其他事件所采取的动作。

## 网络边缘

网络边缘——端系统

### 通信模型

1. 客户/服务器模型（C/S）。
2. 对等模型（P2P）：所有主机同时承担服务器和客户机的双重身份。

### 接入网

1. 家庭接入：
   - Modem拨号：通过本地电话回路点对点连接ISP的拨号池（通常是路由器）。
     - 速度最高可达56kbps。
     - 无法实现在上网的同时拨打电话。
   - ADSL（Asymmetric Digital Subscriber Line）拨号：DSL（Digital Subscriber Line）数字用户线。ISP是本地电话公司，每个用户使用DSL调制解调器与电话公司本地中心局的数字用户线接入复用器（DSLAM）交换数据。ASDL拨号是常用的方式，这种非对称体现在上下行速率不同。
     - 下行/上行速率最高可达55Mbps/15Mbps。
     - 采用频分复用（FDM）技术，可以边上网边打电话。
       - 0kHz—4kHz：语音
       - 4kHz—50kHz：上行
       - 50kHz—1MHz：下行
     - 带宽独享
   - 电缆因特网接入（cable Internet access）：利用的是有线电视公司现有的有线电视基础设施。该系统中使用了光线和同轴电缆，因此也叫混合光纤同轴网络（HFC Hybrid Fiber Coax）。这里使用的是电缆调制解调器（cable modem），而有线电视公司则使用的是电缆调制解调器端接系统（CMTS Cable Modem Termination System），和上述的DSLAM具有类似的功能。
     - 下行/上行速率最高可达40Mbps/30Mbps。
     - 带宽共享。
   - 光纤到户（FTTH Fiber To The Home）：从本地中心局到每户设置一根光纤，实际上许多家庭共享一根光纤，共有两种有竞争性的光纤分布体系结构：有源光纤网络（AON Active Optical Network）、无源光纤网络（PON Passive Optical Network）。
2. 局域网接入：
   - 公司/大学的局域网（LAN） 将端系统连接到边缘路由器。
   - 以太网：通过共享或专用的链路来连接端系统和路由器，有10Mbps、100Mbps、1000Mbps、10Gbps等。
3. 无线接入：
   - 共享的无线接入网络连接端系统和路由器（通过基站）。
   - 无线局域网WiFi：802.11（最高1Gbps（802.11ac））。
   - 广域无线接入：由电信运营商提供，如3G、4G、5G，802.16(WiMAX)。

### 物理媒体

- 导引型媒体：信号沿着固体媒体被导引。
  - 双绞线：两根互相绝缘的铜导线。
    - 3类线：传统的电话线， 10Mbps以太网。
    - 5类线：100Mbps以太网。
    - 6类线：1Gbps以太网。
  - 同轴电缆：两根同心铜导体。
    - 双向传输。
    - 导引型共享媒体。
    - 基带：电缆上单信道，以太网。
    - 宽带：电缆上多信道，HFC。
  - 光缆：在玻璃光纤传播光脉冲，每一个脉冲一比特。
    - 高速，低误码率，衰减率低，不受电磁干扰，不易窃听。
    - 长途导引型传输媒体。
  
- 非导引型媒体：无线电，信号自由传播
  
  - 特性
    - 通过电磁频谱传播信号，没有物理“线路”。
    - 双向传输。
    - 传播环境影响（反射、障碍物、干扰）。
  
  - 地面微波：可达45Mbps
  - 无线局域网：2/11/54Mbps
  - 无线广域网：如3G/4G
  - 卫星（同步卫星vs低纬度卫星）：可达45Mbps的信道（或多个较小的信道），270毫秒的端到端延迟。

## 网络核心

网络核心是由互联因特网端系统的分组交换机和链路构成的网状网络。

### 电路交换

过程：

1. 建立连接
2. 交换数据
3. 释放连接

特征：

- 数据交换前需建立起一条从发端到收端的**物理**通路。
- 在数据交换的全部时间内用户**始终占用**端到端的固定传输信道。
- 交换双方可实时进行数据交换而不会存在任何延迟（？这里指排队时延）。

复用：

1. 时分复用（TDM Time Division multiplexing）：类似与操作系统的分时技术，就是将线路的使用时间划分成时间片，循环分配给各个用户。
2. 频分复用（FDM Frequency Division Multiplexing）：将线路中的通信按频率划分，分配给各个用户。

问题：

1. 计算机之间的数据交换往往具有突发性和间歇性特征，而对电路交换而言，用户支付的费用则是按用户占用线路的时间来收费的。
2. 不够灵活。只要在通话双方建立的通路中的任何一点出了故障，就必须重新拨号建立新的连接，这对紧急和重要通信是很不利的。
3. 电路交换不能够利用全部带宽。

### 分组交换

过程：

1. 在发送端，先把较长的报文划分成较短的、固定长度的数据段。
2. 每一个数据段前面添加上首部构成分组。
3. 分组交换网以“分组”作为数据传输单元。
4. 依次把各分组发送到接收端。
5. 接收端收到分组后剥去首部还原成报文。
6. 最后，在接收端把收到的数据恢复成为原来的报文。

首部的重要性：

- 每一个分组的首部都含有地址等控制信息。
- 分组交换网中的结点交换机根据收到的分组的首部中的**地址信息**，把分组转发到下一个结点交换机，用此种**存储转发**方式，最后分组就能到达最终目的地。

特征：

- 被传送的数据分成若干分组分别传送。
- 数据传输前不必预先确定分组的传输路径。
- 网络核心中的每个交换结点均为共享结点,并且都具有分组的存储/转发以及选择合适路由的能力。
- 在数据通信的过程中，网络核心断续(动态)分配传输带宽，使得通信线路的利用率得以大大提高。
- 为了提高分组交换网的可靠性，网络核心常采用网状拓扑结构，使得当发生网络拥塞或少数中间交换结点、链路出现故障时，可灵活地改变路由而不致引起通信的中断或全网的瘫痪。
- 通信网络的主干线路往往由一些高速链路构成。

转发：通过路由器将分组从源主机移动到到目的主机。

转发方式：

- 数据报网络：
  - 分组内的目的地址决定下一跳。
  - 在会话过程中路由可能改变。

- 虚电路网络
  - 每个分组携带一个标识（虚电路号），该标识决定下一跳。
  - 在呼叫建立时决定固定的路径，并在整个呼叫过程中保持不变。
  - 路由器保持每个呼叫连接的状态。

优点：

- 在相同条件下，分组交换能够比电路交换支持更多的用户。
- 当用户数较少时，分组交换能够获得比电路交换更好的性能。

问题：

- 分组在各结点存储转发时因要排队总会造成一定的时延。当网络通信量过大时，这种时延可能会很大。
- 各分组必须携带一定的控制信息（说明信息），从而带来额外开销。
- 整个分组交换网的管理和控制比较复杂。

## 网络的网络

![](./img/nw1.png)

- 网络结构1：各种端系统使用上述的各种方式接入本地的ISP，并经过该ISP接入因特网，因此该ISP称为接入ISP（access ISP）。在第一种网络结构中，我们使用单一的全球传输ISP将所有接入ISP进行互联，其中接入ISP向全球传输ISP付费，故前者被认为是客户，后者被认为是提供商。

- 网络结构2：在网络结构1中全球传输ISP显然是过于理想化的，在网络结构2中，全球传输ISP被拆分为多个。

网络结构3：上述的两种结构都是两层结构，但是还是很理想化的，因为没有哪个ISP能够无处不在，相反，在任何给定的区域，可能有一个区域有一个区域ISP（regional ISP），区域中的接入ISP与之连接。而进一步每一个区域ISP与第一层ISP（tier-1 ISP）连接，全球范围内大约有十几个第一层ISP。

- 网络结构4：在网络结构3这样一个等计划的网络结构上添加部分额外的结构：
  - 存在点（Point of Presence PoP）：存在于等级结构的所有层次，但底层的接入ISP除外。一个PoP只是提供商网络中的一台或多台路由器（在相同位置）的群组，客户ISP能够在这里与提供商ISP连接。
  - 多宿（multi-home）：规定了任何ISP，除第一层以外，可以选择与两个或者更多提供商ISP连接，这种设置可以保障一个ISP出现故障时，它仍然能够继续发送和接受分组。
  - 对等（peer）：规定了位于同一等级结构层次的相邻一对ISP能够直接将它们的网络连接在一起，使它们之间的所有流量直接连接而不是通过上游的中间ISP传输。
  - 网络交换点（IXP Internet Exchange Point）：作为一个汇合点，多个ISP能够在这里一起对等。

- 网络结构5：在网络结构4之上增加内容提供商网络（Context Provider Network）构成了网络结构5。内容提供商能够使用专用网络与较低层的ISP对等，绕过较高层ISP。

## 时延、丢包与吞吐量

时延和丢包产生原因：

1. 分组到达输入链路的速率超出了输出链路的能力。
2. 分组队列，等待转发，因此产生了四种分组时延（下详）。

### 时延

1. 节点处理时延d~proc~
   - 检查比特错误。
   - 确定输出链路。
   - 通常是低于毫秒级别。
2. 排队时延d~queue~
   - 输出链路等待传输的时间。
   - 取决于路由器的拥塞程度。
3. 传输时延d~trans~
   - 分组长度L，链路带宽R，d~trans~=L/R。
4. 传播时延d~prop~
   - 物理链路长度d，媒体中的传播速度s，d~prop~=d/s。

### 排队时延的进一步讨论

设链路带宽为R（bps），分组长度L（bits），平均分组到达速率（a），则定义流量强度k=La/R。

- k~0：平均排队时延很小，甚至为0；
- k<1：时延较小，且会随着时间推延而变小；
- k=1：时延不会变化，具体数值取决于当时队列长度；
- k>1：平均时延较大，且随着时间推延而趋于无穷。

### 丢包

原因：缓存中队列的容量有限。当分组到达队列已满时，则分组被丢弃，即丢包。

丢失的分组可能会被前一个节点、源端系统重新传输，或者根本不重传。

- 吞吐量：在发送方与接收方之间传输比特的速率（bps）。
  - 瞬时吞吐量：接收方收到文件的瞬时速率。
  - 平均吞吐量：设接收方收到一个大小为F（bit）的文件，耗时T（s），则平均吞吐量为F/T（bps）。
- 瓶颈链路一般就是通路上上吞吐量最小的那一段链路，他限制了端到端平均吞吐量。

## 协议层次和服务模型

### 基本概念

- 实体（Entity）：实体是任何可以发送和接收信息的硬件和软件进程。通常是一个特定的软件模块。
- 对等体（Peer）：不同机器上包含对应层的实体称为对等体。
- 协议（Protocol）：
  - 语法，即数据与控制信息的结构或格式。
  - 语义，即需发现何种控制信息，完成何种动作以及做出何种应答。
  - 同步，即事件实现顺序的详细说明。
- 服务（Service）：为保证上层对等体之间能互相通信，下层向上层提供的功能。
- 服务原语（Service Primitive）：服务原语是指网络相邻层间进行交互时所要交换的一些**必要**命令。
- 服务访问点（SAP Service Access Point）：服务访问点是同一系统中相邻两层的实体进行交互的地方。
- 协议数据单元（PDU Protocol Data Unit）：协议数据单元是对等层次上传送数据的单位。
- 服务数据单元（SDU Service Data Unit）：服务数据单元是层与层之间交换数据的单位（通俗讲，当前层SDU就是上层PDU）。
- 网络体系结构（Network Architecture）：网络体系结构就是层和协议的集合。
- 协议栈（Protocol Stack）：一个特定的系统所使用的一组协议（每层一个协议）称为协议栈。

### 因特网的协议栈

- 应用层：支持网络应用（FTP，SMTP，FTTP）。
- 运输层：主机间数据传输（TCP，UDP）。
- 网络层：将数据包从源端传到目的端（网际协议IP，路由选择协议）。
- 链路层：数据在网络相邻结点之间传输（PPP，以太网协议）。
- 物理层：在线路上传输比特流。

![](./img/nw2.png)

分层的理由：

- 显式的结构使得复杂系统的问题定位和不同组成部分之间的关联讨论成为可能，分层的参考模型(reference model) 可用于讨论。
- 模块化简化了系统的维护和升级，某个层次服务实现的改变对系统的其余部分是透明的。

![](./img/nw3.png)